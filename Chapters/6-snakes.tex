% missing color palette desc
% missing side views?
% vec field desc
% 

\chapter{Case Study 2: Snakes}
\section{Literature Review}
Snakes are long legless reptiles that display many pigmentation patterns such as speckles, blotches, and longitudinal and transverse stripes, some of which are shown in Fig \ref{fig:realSnakePatterns}. The snake is entirely covered in scales. The top of which is made of translucent keratin. Under this top layer is where pigmentation patterns are found. Although the keratin is translucent, it may contribute to the pattern's appearance by acting as prisms through which light refracts, producing an iridescent sheen. Scales may also limit diffusion of pigments across the scale boundary as seen in the ocellated lizard \citep{manukyan2017}.

Pigmentation patterns perform many useful functions, such as hiding the snake from prey and helping the snake itself avoid becoming prey. These functions are fulfilled by camouflaging the snake from potential predators or acting as a brightly coloured warning signal that the snake may be venomous. An example warning pattern is seen on the north American coral snake, \textit{Micrurus fulvius}, with its distinctive red, yellow, and black coloured bands. Some non-venomous snakes employ a form of mimicry called Batesian mimicry. This serves as a defence mechanism by displaying a pattern similar to a venomous snake's pattern. A well-known example of this is the scarlet king snake, \textit{Lampropeltis elapsoides}, who also displays red, black and yellow bands like \textit{M. fulvius}, shown in Fig \ref{fig:realSnakePatterns}.

The regions of a snake that display pigmentation patterns can be roughly partitioned as the head, body, tail, and underbelly. The main patterns of interest in this work occur on the body and tail, which are often indistinguishable. The similarity between patterns found on these regions and those found on the head or underbelly vary between species. It is not uncommon for the head or underbelly to display a different pattern than each other or what is seen on the body. This may be due to the difference in scale shape between regions as well as the visibility and importance of these regions. A notable example is the ring-necked Snake which presents a plain brown color on its back which serves as camouflage. When the ring-necked snake is provoked, it will display its bright red and orange underside to deter predators.

\begin{figure}[hb]
	\centering
	\includegraphics[width=\columnwidth]{snakes.png}
	\caption{A collection of snakes with interesting patterns. \textbf{top-left:} The tail of a ring-necked snake. Photograph by Peter Paplanus licensed under CC BY-NC 2.0. \textbf{top-middle:} A Scarlet King Snake. Photograph by Andrew DuBois licensed under CC BY 2.0. \textbf{top-right:} A Sonoran Coral Snake. Photograph by David Jahn licensed under CC BY-SA 2.0. \textbf{bottom-left:} A python. \textbf{bottom-right:} A cornsnake. Photographs from Pixabay under CC0.}
	\label{fig:realSnakePatterns}
\end{figure}

Patterns on the ocellated lizard have been simulated by \citep{manukyan2017}. These lizards are covered in a quasi-hexagonal lattice of pigmented scales. As a juvenile, the lizard's scales display white spots on a brown background. This pattern changes in adults, whose scales are coloured individually either a solid green or black. These scales also switch between colours over the lifetime of the lizard. By studying pattern formation on ocellated lizards over three to four years, it was found that the colouration of each scale can be modelled by a reaction-diffusion system with diffusion varying across the scale boundaries. Consequently, the diffusion between scales is much slower than inside an individual scale. This results in scales acting as cells in a discrete reaction-diffusion model. Remarkably, this reaction-diffusion system behaves as a cellular automaton when the diffusion between scales is low enough.

Many natural patterns are seen in their final stable state or at a single point during their development. Observations of development over time are often difficult to observe because pattern formation occurs slowly or during a time when the animal is very young. The development of pigmentation patterns has been studied in Japanese four-lined snakes (\textit{Elaphe quadrivirgata}) \citep{murakami2018}. The characteristic pattern \textit{E. quadrivirgata} displays is light brown background color with four black lateral lines. In juveniles, these stripes are dark brown and connected like a ladder. At different points in time during embryonic development, these snakes were measured to gain an understanding of their physical and colouration changes.
 
Pigmentation is measured by observing chromatophore cells, which contain pigmentation molecules. A type of chromatophore, called a melanophore is responsible for brown to black colouration and are first seen in deeper tissues of \textit{E. quadrivirgata} around 18-21 days. But it is stated that these cells did not affect the later development of melanophores seen in the dermal and epidermal layers. Striped pigmentation patterns were first seen to emerge behind the head after 26-32 days. This pattern then appears on the whole body, first thinly at 29-35 days and then clearly at 40-42 days. This pattern development continues after the snake has hatched. These observations are valuable because they give insight into the required initial conditions of a reaction-diffusion simulation.

\citet{pinheiro2017} created snake patterns by using a combination of textures, cellular automaton, and image manipulation to generate texture for triangular meshes. To simulate a transverse stripe pattern, users can define up to four different coloured bands of various thickness. Similarly, for longitudinal stripes, the user defines the number and colour of the stripes which are then blended together with a background colour. To simulate spots, the user can choose from a selection of randomly distorted circles. For other simple patterns, cellular automata are used to generate blotch or zigzag patterns. The patterns generated are very uniform, so they are distorted using Perlin noise. This results in a generated texture which is rendered on a snake mesh. They enhanced these patterns by using a roughness and height map to give the snake model scales. This approach produces very convincing results, although they note that more complex patterns need an approach such as chemotaxis, which involved simulating PDEs with chemicals removing up concentration gradients.

Snake pattern diversity has been studied by using reaction-diffusion as a method to quantify snake patterns \citep{Allen2013}. This quantification was achieved by having users compare snake-like reaction-diffusion patterns, simulated on a grid, against real snake images. This provided an association between a reaction-diffusion model and a real image resulting in a parameter representation of the real snakeâ€™s pattern. These parameters represent visual features such as pattern size, complexity, and anisotropy. Also, snake pattern evolution is then represented by changes in parameter values. To gain insight into how patterns are related to snake behaviour and their environment, these parameters are associated with ecological and behavioural variables. Phylogenetic analysis then reveals to what extent the environment and or  snake behaviour is responsible for the diversity of patterns. The results of this analysis suggested that snake patterns are mainly driven by behaviour rather than the environment the snakes inhabited. They found that plain longitudinally striped snakes are usually smaller and prefer to flee from predators. The striped pattern serves to cause the snake to be harder to track by sight while moving. Transverse striped and blotched snakes are often larger and more aggressive. They may also be more venomous and hunt by ambush.

A biologically motivated model of snake patterns has been studied by \citep{MURRAY1991} where they model the movement and interaction of chromatophores. Before chromatophores differentiate, they exist as chromatoblasts, which are found uniformly in the dermis. After some time, these cells may become chromatophores by producing pigments, resulting in a visible pattern. The phenomenon of cell movement towards higher density is called chemotaxis. Although it is unclear when and where this effect is present in real snakes, its use affords the creation of simple and more advanced patterns when calculated on a growing domain. Although it is admitted that standard reaction-diffusion models may also produce the same patterns.

The chemotaxis-cell model contains one morphogen, $n$, representing the concentration of chromatophores. These chromatophores diffuse and reproduce by mitosis. The chromatophores produce a second morphogen, $c$, known as a chemoattractant which diffuses and decays. Chromatophores undergo reverse diffusion towards higher concentrations of chemoattractant. This  causes patterns to sharpen. Mathematically this model is:

\begin{equation}
\begin{aligned} \label{eq:chemotaxis}
  \frac{\partial n}{\partial t} &= D \Lap{} n - \alpha \Div{} (n\Grad{}c) + srn(N-n), \\
  \frac{\partial c}{\partial t} &= \Lap{} c + s(\frac{n}{1+n}-c).
\end{aligned}
\end{equation}

Using this model, they can produce transverse and lateral stripes. By growing the domain, they can produce more intricate patterns such as staggered and side-by-side spots as well as diamond shaped patterns. These simulations are carried out on a grid, and again only the patterns on the body of the snake are considered.

\newpage

\section{Model Description}
I have produced snake patterns using reaction-diffusion on a triangular mesh. This mesh contains no holes so there are no boundary conditions to consider. Often my models will use different parameters for the ventral scales. Snake models have been rendered using the 3D computer graphics software named Blender. A normal map is used to add a scaly appearance to the triangular mesh. Two black spheres are used to represent snake eyes.

% first model
The first snake model displays brightly coloured transverse stripes like that of the Honduran milk snake (\textit{Lampropeltis triangulum hondurensis}). This species is non-venomous but appears similar to other venomous snakes. The Gray-Scott reaction-diffusion equations, Eq. \ref{eq:grayscottRD}, are used. The initial distribution of morphogens and final pattern are shown in Fig \ref{fig:Snake1}. The parameter values for this model are found in Table \ref{tab:snakeParameters}.

\begin{figure}[ht]
	\centering
	\includegraphics[width=\columnwidth]{Snake1.png}
	\caption{Rendering of a snake with transverse stripes. The morphogen $a$ is visualized where concentration values from low to high are coloured dark orange, black, and bright orange. \textbf{Top-left:} $a$ is set to $1$ on the snout and $0$ elsewhere. \textbf{Bottom-left:} The final pattern. \textbf{Right:} An image of a real Honduran milk snake.}
	\label{fig:Snake1}
\end{figure}

% second model
The next snake model displays a pattern consisting of four black lateral stripes, like that of an adult \textit{E. quadrivirgata}. Again, I have used the Gray-Scott model with anisotropy, specifically $a$ uses coefficients $\lambda_{1}=0.502$, $\lambda_{2}=1$. Diffusion of $s$ remained isotropic. The vector field used by $a$ is pre-computed with another simulation consisting of only diffusion of a single morphogen. A source was defined at a vertex on the tip of the snout and the normalized gradient of the resulting morphogen distribution was saved for use as a vector field. Parameter values for this model are found in Table \ref{tab:snakeParameters}. The ventral scale's parameters vary from those used on the dorsal side so that extra lines do not form on the underside. Initial pattern state and the final pattern are shown in Fig \ref{fig:Snake2}.

\begin{figure}[ht]
	\centering
	\includegraphics[width=\columnwidth]{Snake2.png}
	\caption{Rendering of a snake with lateral stripes. The morphogen $a$ is visualized with low concentration values are coloured brown and high values are black. \textbf{Top-left:} The initial morphogen distribution is $s=1$ and $a=0$ except a stripe of $a=1$ down the dorsal side of the snake. \textbf{Bottom-left:} The final pattern. \textbf{Right:} An image of a real \textit{E. quadrivirgata}.}
	\label{fig:Snake2}
\end{figure}

% third model - 11028.041 to 44303.008 area
The third model I made displays a spot or blotch pattern. These snakes respond to predators by fleeing a short distance and then freezing in place. When being pursued, this behaviour can cause the snake to appear as if they vanished as the predator cannot visually track it \citep{lillywhite2014}. This is another Gray-Scott model, but pattern formation includes growth and adaptive subdivision of the domain. There are two phases to pattern formation in this model. In phase 1, a row of spots form on the snake from a random placement of morphogens. After 100,000 iterations these spots are established and phase 2 begins. During this phase the snake is scaled-up uniformly by 1.002 every 200 iterations. Faces of the mesh are subdivided when they exceed the max face area of 1. This phase runs for 70,000 iterations. During this phase the surface area of the snake increases by a factor of 4, allowing for the spot pattern to form into two rows of spots. This is shown in Fig \ref{fig:Snake3} and parameter values for this model are found in Table \ref{tab:snakeParameters}.

\begin{figure}[ht]
	\centering
	\includegraphics[width=\columnwidth]{Snake3.png}
	\caption{A growing snake with a spot pattern. \textbf{Top-left:} Start of phase 1 showing the initial morphogen distribution of $s=1$ and $a=0$ except for 30 randomly placed spots of radius 2 where $a=1$. \textbf{Left-middle:} A pattern of spots has formed along the snake. This is the end of phase 1 and the start of phase 2. \textbf{Bottom-left:} End of phase 2 where rows of spots have formed on an enlarged snake. \textbf{Right:} An image of a real spotted rock snake.}
	\label{fig:Snake3}
\end{figure}

%Fourth model
The common European viper, \textit{Vipera berus}, displays an interesting zig-zag pattern. This snake is venomous,   and the pattern can serve as a warning signal or as camouflage when the snake is tightly coiled \cite{lillywhite2014}. I have used the Gray-Scott equations to model this pattern by incorporating anisotropic diffusion. Specifically, $a$ uses coefficients $\lambda_{1}=0.81$, $\lambda_{2}=1$ and the diffusion of $s$ is isotropic. The results of this model are shown in Fig \ref{fig:Snake4} and parameter values are found in Table \ref{tab:snakeParameters}.

\newpage 

\begin{figure}[ht]
	\centering
	\includegraphics[width=\columnwidth]{Snake4.png}
	\caption{\textbf{Top-left:} The initial distribution of $a$ is randomly chosen from $[.5, 1)$ for each vertex and $s=1$ everywhere. The concentration of $a$ is seen normalized by 3.8 to show the character of the start state. \textbf{Bottom-left:} The final pattern. In this case $a$ normalized by $1.8$. \textbf{Right:} An image of a real \textit{V. berus}. Photograph by Benny Trapp licensed under CC BY 3.0}
	\label{fig:Snake4}
\end{figure}

%Fifth model
This snake model is based on the transverse stripes of a southern coral snake (\textit{Micrurus frontalis}). The stripes are brightly coloured and are a warning to others that this snake contains a potent venom. I used Gray-Scott with growth to model this pattern. The associated parameter values are found in Table \ref{tab:snakeParameters}. There are two phases, one to establish a starting pattern and another where the mesh grows. During phase 2 the mesh grows by $1.0015$ every $100$ iterations and the max face area is $1$. The snake mesh used is shown in Fig \ref{fig:Snake5} and lacks the bends seen previously. This is because to when adding bends to the mesh, the surface area was not preserved. This results in more area being associated with the outer side of the bends and during growth this does not maintain stripes.

\begin{figure}[ht]
	\centering
	\includegraphics[width=\columnwidth]{Snake5.png}
	\caption{Model of \textit{M. frontalis}. \textbf{Top-left:} Initially $s=1$ and $a=0$ everywhere except on the snout, where $a=1$. $a$ is visualized from red to black to white and is normalized by $0.520$. \textbf{Middle-left:} end of phase 1 where a basic stripe pattern has formed. \textbf{Bottom-left:} The final pattern after growth. Black stripes have appeared in-between the previous stripes. \textbf{Right:} A picture of a real \textit{M. frontalis}.}
	\label{fig:Snake5}
\end{figure}

\newpage 

The California kingsnake (\textit{Lampropeltis californiae}) contains a white and black transverse stripes which sometimes bifurcate. I have modelled this using the activator-depleted substrate model with saturation, Eq \ref{eq:ladybugRD}, and anisotropic diffusion. On the snake body, morphogen $u$ uses coefficients $\lambda_{1}=0.75$, $\lambda_{2}=1$ and $v$ uses $\lambda_{1}=1$, $\lambda_{2}=0.75$. The head uses isotropic diffusion as the real snake does not have stripes on its head. The parameter values are: $D_u=0.056$, $D_v=3.36$, $dt=0.01$, $\kappa=0.5$, $p_u=0.18$, $p_v=0.36$, $s_u=0.001$, $s_v=0.1$, and $u_u=0.08$. This model runs for $70,000$ iterations. The results are shown in Fig \ref{fig:Snake6}.

\begin{figure}[h]
	\centering
	\includegraphics[width=\columnwidth]{Snake6.png}
	\caption{Model of \textit{L. californiae}. Morphogen $u$ is visualized as white when its value is low and black when high. \textbf{Top-left:} The initial distribution is $u=0$ and $v=1$ everywhere except a lateral stripe  of $u=1$. \textbf{Bottom-left:} The final pattern. \textbf{Right:} An image of a real \textit{L. californiae}}
	\label{fig:Snake6}
\end{figure}

\newpage

\section{Discussion}
Snake pattern formation is of great interest to herpetologists, who study reptiles and amphibians. They can understand snake evolution through the myriad of patterns snakes display. Others such as snake breeders profit off selling snakes that display striking and unique patterns. Consequently, there is also a financial incentive predict and create snake patterns quickly. 

Snake patterns provide an interesting modelling challenge. I have produced a variety of different visually similar snake patterns. By using the features of \ProgramName{} such as growth and anisotropy I was able to generate more complex patterns. As shown in Fig \ref{fig:SnakeRendering}, reaction-diffusion models can be used with computer graphics to produce textures for digital works. Some future work can be made by understanding the role of scale thickness and shape on pattern formation. Incorporating this into a discrete model would allow for modelling of patterns seen on the snake head and ventral scales. More complex models of growth may be able to produce more accurate patterns as well.

\begin{table}[h]
	\centering
	\begin{tabular}{|l|l|l|l|l|l|l|l|}
	\hline
	Model & Species                      &$D_a$ &$D_s$ &$f$    &$k$   &$dt$ &Total steps (x1000)\\ \hline 
	A     &\textit{Milk Snake}		     &1.000 &2.000 &0.026 &0.055 &0.030 &200                \\ \hline
	B     &\textit{Lateral Stripe}       &0.175 &0.350 &0.078 &0.061 &0.030 &28                 \\ \hline
	C     &\textit{Spots}                &0.350 &0.700 &0.022 &0.022 &0.100 &100; 70            \\ \hline
	D     &\textit{Zigzag}               &0.150 &0.300 &0.109 &0.053 &0.300 &40                 \\ \hline
	E     &\textit{Southern Coral Snake} &1.000 &2.000 &0.034 &0.057 &0.030 &200; 23            \\ \hline
	\end{tabular}
	\caption {In B and C the ventral scales have $f=0$. In D the ventral scales have $f=0$ and $k=0.08$. In the \Quotes{Total steps (x1000)} column, values separated by a semicolon denote a multi-phase model with the first and second values representing phase 1 and 2 respectively.}
	\label{tab:snakeParameters}
\end{table}

% snake on ground with some iridescence
\begin{figure}[p]
	\centering
	\includegraphics[width=\columnwidth]{ground_1.png}
	\caption{A rendering of a snake.}
	\label{fig:SnakeRendering}
\end{figure}